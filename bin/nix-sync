#!/usr/bin/env bash
set -euo pipefail

REPO_DIR="$HOME/.config/starterpack"
DOTFILES_DIR="$REPO_DIR/dotfiles"

if [ ! -d "$REPO_DIR" ]; then
  echo "Error: Repository not found at $REPO_DIR"
  exit 1
fi

echo "Syncing live configs back to nix-darwin repo..."
echo

# Cursor settings
echo "→ Cursor settings"
cp "$HOME/Library/Application Support/Cursor/User/settings.json" "$DOTFILES_DIR/cursor/settings.json"
cp "$HOME/Library/Application Support/Cursor/User/keybindings.json" "$DOTFILES_DIR/cursor/keybindings.json"

# iTerm2 preferences
echo "→ iTerm2 preferences"
if [ -f "$HOME/.config/iterm2/com.googlecode.iterm2.plist" ]; then
  cp "$HOME/.config/iterm2/com.googlecode.iterm2.plist" "$DOTFILES_DIR/iterm2/com.googlecode.iterm2.plist"
else
  echo "  (iTerm2 plist not found - skipping)"
fi

# Claude configuration
echo "→ Claude configuration"
if [ -f "$HOME/.claude/settings.json" ]; then
  cp "$HOME/.claude/settings.json" "$DOTFILES_DIR/claude/settings.json"
else
  echo "  (Claude settings not found - skipping)"
fi
if [ -f "$HOME/CLAUDE.md" ]; then
  cp "$HOME/CLAUDE.md" "$DOTFILES_DIR/claude/CLAUDE.md"
else
  echo "  (CLAUDE.md not found - skipping)"
fi

echo
echo "Sync complete! Changes:"
echo

cd "$REPO_DIR"
git diff --stat

echo
echo "Run 'cd ~/.config/starterpack && git diff' to see detailed changes"
echo "Run 'git add -A && git commit' to save changes"
